(window._bee_jsLoaded=window._bee_jsLoaded||{})["phone_m_min.all.js"]=1;
/*![partner/Partner.js]*/define("partner/Partner",["lib/base","partner/utils","partner/basic"],function(e,n,t){var i,o,r,a=1==$.getParam("partnertest"),c=!1,s={},u=function(e,n){if(!i){var t=$.isFunction(n)?n():n;return!(!t||!(i=Bee.getMod("partner/"+e,!0)))&&(i.key=e,!0)}};u("weixin",$.isWeixin),u("weibo",$.isWeibo),u("nuomi",$.isNuomi),u("daojia58",$.isDaojia58),u("baiduapp","zhidahao"==$.getParam("tn")),u("baidumap",$.isBaidumap),u("bestpay",$.isBestpay),u("html5plus",navigator.userAgent.indexOf("qihoo")>-1||navigator.userAgent.indexOf("Html5Plus")>-1),u("kuaiqian",$.isKuaiqian),i=i||{};var l=e.onceExecMulitCallFn(function(){var e=this;i.name&&i.init?a?e.done({success:!0}):i.init(function(n){n!==!0&&n!==!1||(n={success:n}),e.done(n)}):e.done({success:!0})}),g=function(e){i[e]?a?s[e]=function(){console.log(e,arguments)}:s[e]=i[e]:t[e]?s[e]=t[e]:s[e]=$.noop};return g("alert"),g("confirm"),g("tip"),g("popSelect"),g("showLoading"),g("hideLoading"),g("exit"),g("setHeaderTitle"),g("setHeaderTabs"),g("setHeaderRightIcon"),g("setOnBackFn"),g("getDeviceId"),g("callPhone"),g("isLogin"),g("autoLogin"),g("login"),s.init=l,s.isPartner=function(){return!(!i.name||!i.init)},s.scanQR=function(e){i.scanQR?a?console.log("scanQR",arguments):i.scanQR.call(s,e):e({success:!1,error:"unsupport"})},s.copy=function(e,n){i.copy?a?console.log("copy",arguments):i.copy.call(s,e,n):n({success:!1,error:"unsupport"})},s.setShare=function(e){e=e||n.DEFAULT_SHARE,r=e,i.setShare&&(a?console.log("setShare",arguments):i.setShare.call(s,e))},s.share=function(){i.share?a?console.log("share",arguments):i.share.call(s):s.alert("当前环境不支持分享",function(){r&&r.onFail&&r.onFail()})},s.isSupport=function(e,n){return n?!!i[e]:!(!i[e]&&!t[e])},s.isSupportPartnerLogin=function(){return!!(i.isLogin&&i.login&&i.autoLogin)},s.getLogicConf=function(e){return!!i.getLogicConf&&(c||(c=i.getLogicConf.call(s)||{}),e in c&&c[e])},s.getSupportPays=function(e){var n;return i.getPays?(n=i.getPays.call(s),$.isObject(n)&&(n=[n])):n=[],n=n.concat(t.getPays()),i.paysFilter&&(n=n.filter(i.paysFilter)),e&&(n=n.filter(function(e){return 0!=e.typeid})),n.sort(function(e,n){return(n.order||100)-(e.order||100)}),n},s.getPay=function(e){var n=!1;return $.each(s.getSupportPays(),function(t,i){if(i.key==e)return n=i,!1}),n},s.getLocation=e.onceExecMulitCallFn(function(){var n,r,c=this,u=(new Date).getTime(),g=!1,p=function(){if(!g){g=!0,clearTimeout(n),clearTimeout(r);var t=(new Date).getTime(),a={success:o.success,expend:t-u,result_partner:o.partner||"basic",partner:i.key||"basic"};o.success?(a.latitude=o.latitude,a.longitude=o.longitude,o.type&&(a.type=o.type)):(a.error=o.error||"",a.errno=o.errno||"",a.errmsg=o.errmsg||""),e.clickLog("sys_geolocation",a),c.done(o)}},f=function(n){o?p():n.success&&5!=n.type?e.getBaiduConv(n.longitude+","+n.latitude,n.type||1,function(e){e&&e.length>0&&(n.longitude=e[0].x,n.latitude=e[0].y),o=n,p()}):n.success?(o=n,p()):(o=n,p())};!a&&i.getLocation?(l(function(e){!o&&e.success&&i.getLocation.call(s,function(e){e.partner=i.key,f(e)})}),r=setTimeout(function(){o||t.getLocation(f)},2500)):t.getLocation(f),n=setTimeout(function(){o||f({success:!1,error:"timeout",errmsg:"GPS定位超时"})},6e3)}),s.getKey=function(){return i.key||"basic"},s.getName=function(){return i.name||"移动端"},s});
/*![partner/utils.js]*/define("partner/utils",["lib/base"],function(r){var o={title:"馋了吗？找爱鲜蜂！",desc:"馋了？忙呢？召唤鲜蜂侠，鲜果咖啡，坚果卤味，各种新鲜，闪电送达！",imgUrl:"http://m.beequick.cn/static/bee/img/icon_100-6607ff98.png",link:"http://m.beequick.cn"},e={shareMask:'<div id="mod-sharemask" class="mod-sharemask"></div>'},i=!1,a=function(r){i||$(e.shareMask).appendTo("body").on($.tapClick,function(){$(this).css("display","none")}),i=!0,$("#mod-sharemask").css("display","block").css("background-color",r?"rgba(0,0,0,.45)":"transparent")},n=function(r){window.localStorage&&window.localStorage.setItem("PAY_REDIRECT",[r.id||r.order_id,r.order_no,(new Date).getTime()].join(","))},d=function(o,e,i){var a=o.id||o.order_id,d=o.order_no,t=SYS_CONF.domain.current+"/show/order/orderNo/"+d+"/orderId/"+a;window.SYS_CONF.tn&&(t+="/tn/"+window.SYS_CONF.tn),window.SYS_CONF.tg&&(t+="/tg/"+window.SYS_CONF.tg),t+="/zhidapay/1",r.ajaxPost("/submit/zhidapayinfo",{orderId:a,orderNo:d,successUrl:t,showUrl:t+"/forward/1"},function(e){0==e.errno?(n(o),r.redirect(e.data.url)):i&&i(e.errmsg)})};return{beforePayRedirect:n,shareTip:a,zhidapay_pay:d,DEFAULT_SHARE:o}});
/*![partner/basic.js]*/define("partner/basic",["partner/utils","lib/base","lib/Loading","common/Dialog_phone"],function(e,t,i,n){var o=function(i,n,o){var r=i.id||i.order_id,a=i.order_no,d=SYS_CONF.domain.current+"/show/order/orderNo/"+a+"/orderId/"+r+($.isSimulateMobile?"/simulate_mobile/true":"");window.SYS_CONF.tn&&(d+="/tn/"+window.SYS_CONF.tn),window.SYS_CONF.tg&&(d+="/tg/"+window.SYS_CONF.tg),$.getParam("qtoken",!1)&&(d+="/qtoken/"+$.getParam("qtoken")),t.ajaxPost("/submit/wapalipayInfo",{orderId:r,orderNo:a,successUrl:d+"/alipay/1",failUrl:d},function(n){0==n.errno?(e.beforePayRedirect(i),t.redirect(n.data.url)):o(n.errmsg)})},r=function(i,n,o){var r=Bee.getMod("partner/Partner");r.hideLoading(),t.ajaxPost("/submit/wapWeixinPay",{orderId:i.id||i.order_id,orderNo:i.order_no},function(t){if(0==t.errno){if(t.data.mweb_url)return e.beforePayRedirect(i),void(window.location.href=t.data.mweb_url);var a=$.formatString("appid=#{appid}&noncestr=#{noncestr}&package=#{package}&prepayid=#{prepayid}&sign=#{sign}&timestamp=#{timestamp}",t.data);a="weixin://wap/pay?"+encodeURIComponent(a),window.location.href=a,r.alert("请在微信中完成支付",function(){n()})}else o(t.errmsg)})};return{name:"当前",init:function(e){e(!0)},alert:function(e,t,i){n.alert(e,t,i)},confirm:function(e,t,i,o,r){n.confirmText(e,t,i,[o||"确定",r||"取消"])},tip:function(e){n.tip(e)},popSelect:function(e,t,i,o){n.popSelect({title:e||"",items:t,onselect:i,oncancel:o})},showLoading:function(e){i.show(e)},hideLoading:function(){i.hide()},getLocation:function(e){var t,i;if(window.SYS_CONF&&window.SYS_CONF.serverDectGps){var n=window.SYS_CONF.serverDectGps;return void setTimeout(function(){e&&e({success:!0,type:5,latitude:n.lat||n.latitude,longitude:n.lng||n.longitude||n.lon,accuracy:-1})},50)}return(t=$.getParam("lat",$.getParam("latitude")))&&(i=$.getParam("lng",$.getParam("longitude")))?void setTimeout(function(){e&&e({success:!0,type:"baidu"==$.getParam("postype",!1)?5:1,latitude:parseFloat(t),longitude:parseFloat(i),accuracy:-1})},50):void navigator.geolocation.getCurrentPosition(function(t){var i=t.coords;e&&e({success:!0,type:1,latitude:i.latitude,longitude:i.longitude,accuracy:i.accuracy})},function(t){e&&e({success:!1,errno:t.code,errmsg:t.message,error:t.code==t.PERMISSION_DENIED?"denied":"unsupport"})},{enableHighAccuracy:!0,maximumAge:0,timeout:3e3})},getPays:function(){return[{key:"wapweixin",name:"微信支付",typeid:1,order:50,pay:r},{key:"alipay",name:"支付宝支付",typeid:2,order:50,pay:o},{key:"delivery",name:"货到付款",typeid:0,order:10,pay:function(e,t,i){t&&t()}}]}}});
/*![partner/weixin.js]*/define("partner/weixin",["partner/utils"],function(e){var n=function(e){window.wx.config(window.SYS_CONF.sns.weixinJsApiConf),window.wx.ready(function(){e&&e({success:!0})}),window.wx.error(function(){e&&e({success:!1})})},i=function(){e.shareTip(!0)},s=function(e){var n=e.imgUrl&&e.imgUrl.indexOf(".beequick.cn")==-1&&e.imgUrl.indexOf("@")<0,i=e.onSuccess||e.success||$.noop,s=e.onFail||$.noop;"online"==SYS_CONF.environ&&n&&(e.imgUrl+="@100h_100w_0e_1l%7C90Q");var r={title:e.title,desc:e.description||e.desc,link:e.link,imgUrl:e.imgUrl,success:i,fail:s,cancel:s},c={title:e.description||e.desc,desc:e.title,link:e.link,imgUrl:e.imgUrl,success:i,fail:s,cancel:s};window.wx.onMenuShareTimeline(c),window.wx.onMenuShareAppMessage(r),window.wx.onMenuShareQQ(r),window.wx.onMenuShareWeibo(r)},r=function(e){window.wx.getLocation({type:"wgs84",success:function(n){e&&e({success:!0,latitude:n.latitude,longitude:n.longitude,accuracy:n.accuracy,type:1})},fail:function(n){var i=n.errMsg||n.err_msg||"";e&&e({success:!1,errmsg:i,error:"unavailable"})}})},c=function(e){window.wx.scanQRCode({needResult:1,scanType:["qrCode"],success:function(n){if($.isString(n)){var i=base.jsonDecode(n.resultStr);e&&e({success:!0,result:i.scan_code.scan_result})}else if(n.resultStr){var s=!1;if(0!=n.resultStr.indexOf("{"))return void(e&&e({success:!0,result:n.resultStr}));s=base.jsonDecode(n.resultStr),e&&e({success:!0,result:s?s.scan_code.scan_result:n.resultStr})}},fail:function(n){e&&e({success:!1,error:"unsupport"})},cancel:function(){e&&e({success:!1,error:"cancel"})}})},t=function(){return{name:"微信支付",key:"weixin",typeid:1,pay:function(e,n,i){base.ajaxPost("/submit/weixinPayinfo",{orderId:e.id||e.order_id,orderNo:e.order_no},function(e){if(0==e.errno){var s=e.data;s.timestamp=s.timestamp||s.timeStamp,s.success=s.fail=s.cancel=function(e){var s=e.err_msg||e.errMsg;s.indexOf("ok")>0?n&&n():s.indexOf("chooseWXPay:cancel")>-1?i&&i("支付被取消"):i(s)},wx.chooseWXPay(s)}else i&&i(e.errmsg)})}}},o=function(e){return 0==e.typeid||"weixin"==e.key},a=function(){window.wx.closeWindow()};return{name:"微信",init:n,share:i,setShare:s,getLocation:r,scanQR:c,getPays:t,paysFilter:o,exit:a}});
/*![partner/weibo.js]*/define("partner/weibo",["partner/utils"],function(e){var n=function(n){var i=window.SYS_CONF.sns.signedParam;if(!i)return void(n&&n({success:!1,errmsg:"未能获取参数"}));var o=function(){if(window.WeiboJS){var t=function(i){0==i.code||200==i.code?(WeiboJS.invoke("setSharingContent",{icon:e.DEFAULT_SHARE.imgUrl,title:e.DEFAULT_SHARE.title,desc:e.DEFAULT_SHARE.desc},$.noop),n&&n({success:!0})):n&&n({success:!1,errno:i.code,errmsg:i.msg})};i.callback=t,WeiboJS.init(i,t)}else setTimeout(o,100)};o()},i=function(e){for(var n in WeiboJS.STATUS_CODE)if(WeiboJS.STATUS_CODE[n]==e)return n;return""},o=function(e){WeiboJS.invoke("getLocation",{},function(n,o,t){n&&n.lat&&n.long?e&&e({success:!0,latitude:n.lat,longitude:n.long,accuracy:-1}):e&&e({success:!1,error:t==WeiboJS.STATUS_CODE.SERVICE_FORBIDDEN?"denied":"unavailable",errmsg:i(t),errno:t})})},t=function(e){WeiboJS.invoke("scanQRCode",{},function(n,i,o){n&&n.result?e&&e({success:!0,result:n.result}):e&&e({success:!1,error:o==WeiboJS.STATUS_CODE.USER_CANCELLED?"cancel":"denied"})})},r=function(){return{name:"微博支付",key:"weibo",typeid:2,pay:function(e,n,i){var o='<form id="mod-pay-weibo-form" method="post" target="_self" action="http://pay.sc.weibo.com/api/merchant/pay/cashier">\n<input type="hidden" name="seller_id" value="#{seller_id}" />\n<input type="hidden" name="appkey" value="#{appkey}" />\n<input type="hidden" name="notify_url" value="#{notify_url}" />\n<input type="hidden" name="out_pay_id" value="#{out_pay_id}" />\n<input type="hidden" name="subject" value="#{subject}" />\n<input type="hidden" name="total_amount" value="#{total_amount}" />\n<input type="hidden" name="return_url" value="#{return_url}" />\n<input type="hidden" name="sign_type" value="#{sign_type}" />\n<input type="hidden" name="sign" value="#{sign}" />\n</form>',t=e.id||e.order_id;base.ajaxPost("/submit/weiboPayinfo",{orderId:t,orderNo:e.order_no,showUrl:SYS_CONF.domain.current+"/show/order/orderId/"+t+"/orderNo/"+e.order_no},function(e){if(0==e.errno){$("#mod-pay-weibo-form").remove();var n=$.formatString(o,e.data);$("body").append(n),$("#mod-pay-weibo-form")[0].submit()}else i&&i(e.errmsg)})}}},a=function(e){return 0==e.typeid||"weibo"==e.key};return{name:"微博",init:n,getLocation:o,getPays:r,paysFilter:a,scanQR:t}});
/*![partner/nuomi.js]*/define("partner/nuomi",["lib/base","partner/utils"],function(t,e){var n=!1,o=function(t){window.BNJS&&"object"==typeof window.BNJS&&BNJS._isAllReady?t({success:!0}):document.addEventListener("BNJSReady",function(){t({success:!0})},!1)},i=0,c=0,a=function(){return{hideHeader:!0,hideNavs:!0,hideWelfare:!0,bootstrapLoading:!0,home_icon_filter:function(t,e){if(c!=e.shopId&&(c=e.shopId,i=0),i>3)return!1;var n=t.activity,o=n&&n.ext_params?n.ext_params.activitygroup:"";return!o||"zhuanpan"!=o&&"xianguoshengyan"!=o&&"ruyuanyichang"!=o&&"lingshidapa"!=o&&"bingyinjie"!=o?!(!n||4!=n.jptype)&&(n.img="/static/bee/img/m/t_nuomi/home_act_menu-0472d638.png",i++,!0):(n.img="/static/bee/img/m/t_nuomi/home_act_"+o+".png",i++,!0)},comment_title_overlay:{right:"[提交评价]",rightTap:"submit"},order_title_overlay:{contentHtml:"订单详情"},search_title_overlay:{right:"[确认]"},px1Conf:{".result-none-notice":"bottom",".edit-del-wrap":"top",".sug-list":"top bottom","li.sug-item":"bottom",".block":"top bottom",".acts-brand-item:nth-child(3n+1),.acts-brand-item:nth-child(3n+2)":"right",".mod-product-item-columns3:nth-child(3n+1),.mod-product-item-columns3:nth-child(3n+2)":"right",".mod-product-item-columns2":"top bottom right left",".mod-product-item-portrait":"bottom",".theme-spline.spline-top,.theme-spline.spline-list":"top",".theme-spline.spline-bottom":"bottom",".acts-scene .acts-scene-item:nth-child(odd)":"bottom right",".acts-scene .acts-scene-item:nth-child(even)":"bottom","tr.theme-spline.spline-list td":"top","tr.theme-spline.spline-top td":"top",".pub-footer":"top",".comment-container .order-stars,.comment-container .tags,.comment-container,.mod-order-imgs":"bottom",".mod-pub-product.operate":"top bottom",".wrapper .property-item":"bottom"}}},r=function(t,e,n){BNJS.ui.dialog.show({message:$.htmlToText(t||""),ok:n||"确定",onConfirm:e||$.noop})},s=function(t,e,n,o,i){BNJS.ui.dialog.show({message:$.htmlToText(t||""),ok:o||"确定",cancel:i||"取消",onConfirm:e||$.noop,onCancel:n||$.noop})},u=function(t){BNJS.ui.toast.show(t||"")},l=function(t,e,n,o){BNJS.ui.actionSheet.show({titleList:e.map(function(t){return t.name}),callback:function(t){0==t.errno&&e[t.data]?n&&n(e[t.data].key):o&&o()}})},m=function(){if(n){var t={title:n.title,content:n.desc||n.description,imgUrl:n.imgUrl,url:n.link,onSuccess:n.onSuccess||$.noop,onFail:n.onFail||$.noop,platforms:(n.limitWeixin?"weixin_session,weixin_timeline":"weixin_session,weixin_timeline,qq_friend,qq_zone").split(",")};BNJS.ui.share(t)}},p=function(t){n=t},d=function(t){return BNJS.location.hasLocation?void(t&&t({success:!0,type:5,latitude:BNJS.location.latitude,longitude:BNJS.location.longitude,accuracy:-1})):void(t&&t({success:!1,error:"unavailable"}))},h=function(t){BNJS.hardware.scanQRCode(function(e){0==e.errno?t&&t({success:!0,result:e.data.content}):t&&t({success:!1,error:"cancel"})})},g=function(){return{name:"百度收银台",key:"zhidapay",typeid:8,order:30,pay:e.zhidapay_pay}},f=function(){BNJS.page.back()},b=function(t){BNJS.device.call(t)},S=function(t){BNJS.page.onBtnBackClick({callback:t||$.noop})},y=function(t,e){BNJS.ui.title.setClickableTitle($.htmlToText(t||""),e||$.noop)},B=function(t,e){BNJS.ui.title.addTagList({id:1001,tagList:t.map(function(t){return t.name}),type:1,callback:function(n){0==n.errno&&t[n.data]&&e&&e(t[n.data].key)}})},N=function(t,e,n){BNJS.ui.title.removeBtnAll();var o={tag:1e3,callback:n||$.noop};if("search"==t||"scan"==t||"close"==t)o.icon=t;else if("reload"==t)o.text="刷新";else{if(!e)return;o.text=e}BNJS.ui.title.addActionButton(o)},J=function(){return BNJS.account.isLogin},_=function(t){BNJS.account.login({type:0,onSuccess:function(){t&&t({success:!0})},onFail:function(e){t&&t({success:!1,errno:1001==e.errno?-1:e.errno,errmsg:e.errmsg})}})},x=function(e){BNJS.account.getCommonSecretAccount({tpFlag:"aixianfeng",requestData:"mobile,siteId",onSuccess:function(n){t.ajaxPost("/submit/nuomiSecret",n,function(t){0==t.errno?e&&e({success:!0,phone:t.data.phone,uid:t.data.siteId}):e&&e({success:!1,errno:t.errno,errmsg:t.errmsg})})},onFail:function(t){e&&e({success:!1,errno:t.errno,errmsg:t.errmsg})}})},v=function(t,e){BNJS.ui.copyText(t,function(t){e&&e({success:0==t.errno})})};return{name:"百度糯米",getLogicConf:a,getPays:g,init:o,alert:r,confirm:s,tip:u,popSelect:l,share:m,setShare:p,getLocation:d,scanQR:h,exit:f,copy:v,callPhone:b,setOnBackFn:S,setHeaderTitle:y,setHeaderTabs:B,setHeaderRightIcon:N,isLogin:J,login:_,autoLogin:x}});
/*![partner/daojia58.js]*/define("partner/daojia58",["lib/base","lib/Loading"],function(t,o){var e="",n=function(t){window.logintip=function(t){t&&(e=t,$(document).trigger("daojialogin",t))},t({success:!0})},i=function(){return{name:"58到家支付",key:"daojia58",typeid:9,pay:function(t,o,e){location.href=t.dj_crasher_url}}},r=function(t){return 9==t.typeid},a=function(){return{hideHeader:!0,bootstrapLoading:!0,isFullScreen:!1,hideNavs:!1,partnerLoginDirectly:!0,hideNavsItems:["home","act","mine"],showActsInMenu:!0,px1Conf:{".mod-product-item-columns3:nth-child(3n+1),.mod-product-item-columns3:nth-child(3n+2)":"right",".mod-product-item-columns2":"top bottom right left",".mod-product-item-portrait":"bottom",".mod-product-item-portrait":"bottom",".block":"top bottom",".theme-spline.spline-top,.theme-spline.spline-list":"top",".theme-spline.spline-bottom":"bottom",".mod-menu .categories-item":"bottom right","tr.theme-spline.spline-list td":"top","tr.theme-spline.spline-top td":"top","tr.theme-spline.spline-list th":"top","tr.theme-spline.spline-top th":"top",".result-none-notice":"bottom",".sug-list":"top bottom","li.sug-item":"bottom",".comment-container .order-imgs":"bottom",".comment-container .tags":"top",".pub-footer":"top",".mod-pub-product.operate,.wrapper .property-item":"top"}}},m=function(){if(e||$.getParam("phone")&&0!=$.getParam("phone"))return!0},p=function(t){location.href="daojia://log_in",$(document).on("daojialogin",function(o){t&&t({success:o&&0!=o,errno:"",errmsg:""})})},s=function(o){t.ajaxPost("/submit/daojia58Auth",{phone:e||$.getParam("phone"),funid:$.getParam("funid")},function(t){o({success:0==t.errno,phone:t.data&&t.data.phone?t.data.phone:"",uid:t.data&&t.data.uid?t.data.uid:"",errno:t.errno,errmsg:t.errmsg})})},d=function(t){document.title=$.htmlToText(t||"生活超市")},u=function(){location.href="daojia://finish"},c=function(t){t="加载中"!=t&&t?t:"正在加载中",o.show(t)};return{name:"58到家",init:n,getPays:i,paysFilter:r,getLogicConf:a,isLogin:m,login:p,autoLogin:s,setHeaderTitle:d,exit:u,showLoading:c}});
/*![partner/bestpay.js]*/define("partner/bestpay",["lib/base"],function(e){var n=!1,t=function(e){var t=function(){window.App?(App.overrideBackPressed(!0),App.setHeaderVisible(!1),App.setKeyEventListener(function(e){"backpress"==e&&n&&n()}),e&&e({success:!0})):setTimeout(t,30)};t()},r=function(){return{isFullScreen:!0}},i=function(e){n=e},o=function(){App.exitApp()},s=function(){return{name:"翼支付",typeid:5,key:"bestpay",pay:function(n,t,r){e.ajaxPost("/submit/bestpayInfo",{orderId:n.id||n.order_id,orderNo:n.order_no},function(e){if(0==e.errno){var n=e.data,i=new BestPay_Payment,o=new BestPay_User;n.ACCOUNTID=o.getProduct()||"",i.onPay(n,function(){t&&t()},function(e){var n=!1;$.isAndroid&&"failuer"==e&&(n="请升级后继续完成支付"),r&&r(n)})}else r&&r(e.errmsg)})}}},a=function(e){return 5==e.typeid};return{name:"翼支付",init:t,setOnBackFn:i,exit:o,getPays:s,paysFilter:a,getLogicConf:r}});
/*![partner/baiduapp.js]*/define("partner/baiduapp",["lib/base","partner/utils"],function(e,i){var n,o=function(e){if(!window.clouda)return void(e&&e({success:!1,errno:-1,errmsg:"no clouda object"}));window.clouda.lightInit({ak:"Gw3bPxqMptqDz1raILOC6N2p",module:"geolocation,device,qr,socialshare".split(",")});var n=0,o=function(){return n++,n>100?void(e&&e({success:!1,errno:-1,errmsg:"waited timeout"})):void(window.clouda&&window.clouda.device&&window.clouda.device.geolocation?e&&e({success:!0}):setTimeout(o,30))};o(),window.noop=$.noop,window.BoxShareData={successcallback:"noop",errorcallback:"noop",options:{type:"url",content:i.DEFAULT_SHARE.desc,iconUrl:i.DEFAULT_SHARE.imgUrl,imageUrl:i.DEFAULT_SHARE.imgUrl,linkUrl:i.DEFAULT_SHARE.link,title:i.DEFAULT_SHARE.title,mediaType:"all"}},$.isAndroid&&delete window.BoxShareData.options.imageUrl},a=function(e){n={mediaType:e.limitWeixin?"weixin":"all",title:e.title,content:e.desc||e.description||"",linkUrl:e.link,imageUrl:e.imgUrl,iconUrl:e.imgUrl,appid:"7140005",onsuccess:e.onSuccess||$.noop,onfail:e.onFail||$.noop},$.isAndroid&&delete n.imageUrl},c=function(){var e=n;"weixin"==e.mediaType?this.popSelect("分享到：",[{key:"weixin_timeline",name:"微信朋友圈"},{key:"weixin_friend",name:"微信好友"}],function(i){e.mediaType=i,window.clouda.mbaas.socialshare.callShare(e)}):window.clouda.mbaas.socialshare.callShare(e)},t=function(e){clouda.device.geolocation.get({onsuccess:function(i){e&&e({success:!0,type:"wgs84ll"==i.coordtype?1:5,latitude:i.latitude,longitude:i.longitude,accuracy:i.accuracy})},onfail:function(i){e&&e({success:!1,error:"unavailable"})}})},l=function(){return{name:"百度收银台",key:"zhidapay",typeid:8,pay:i.zhidapay_pay}},r=function(e){return 8==e.typeid},s=function(e){window.clouda.device.getImei({onsuccess:function(i){e&&e({success:!0,id:i})},onfail:function(){e&&e({success:!1})}})};return{name:"直达号",init:o,share:c,setShare:a,getLocation:t,getDeviceId:s,getPays:l,paysFilter:r}});
/*![partner/baidumap.js]*/define("partner/baidumap",["partner/utils"],function(e){var t=function(e){e&&e({success:!0})},n=function(){return{hideHeader:!0,hideNavsItems:["home","mine","act"],disableAutoSelectLastAddr:!0}},a=function(){return{name:"百度收银台",key:"zhidapay",typeid:8,pay:e.zhidapay_pay}},i=function(e){return 8==e.typeid};return{init:t,name:"百度地图",getLogicConf:n,getPays:a,paysFilter:i}});
/*![partner/html5plus.js]*/define("partner/html5plus",function(){var n,e=function(n){window.plus?n&&n({success:!0}):$(document).on("plusready",function(){t(),n&&n({success:!0})})},i=null,t=function(){plus.share.getServices(function(n){i={},$.each(n,function(n,e){i[e.id]=e,e.authenticated||e.authorize($.noop,$.noop)})}),function(n){i=n.message||"没有分享服务"},plus.key.addEventListener("menubutton",function(n){o("请选择",[{key:"reload",name:"刷新页面"}],function(n){"reload"==n&&window.location.reload()})})},o=function(n,e,i,t){plus.nativeUI.actionSheet({title:n||"",cancel:"取消",buttons:e.map(function(n){return{title:n.name}})},function(n){0==n.index?t&&t():i&&i(e[n.index-1].key)})};return{name:"流应用",init:e,getLogicConf:function(){return{isFullScreen:!0}},alert:function(n,e,i){plus.nativeUI.alert($.htmlToText(n),e||$.noop,"",i||"确定")},confirm:function(n,e,i,t,o){plus.nativeUI.confirm($.htmlToText(n),function(n){0==n.index?e&&e():i&&i()},"",[t||"确定",o||"取消"])},tip:function(n){plus.nativeUI.toast(n,{verticalAlign:"center"})},popSelect:o,showLoading:function(n){plus.nativeUI.showWaiting(n||"加载中")},hideLoading:function(){plus.nativeUI.closeWaiting()},getLocation:function(n){window.plus.geolocation.getCurrentPosition(function(e){n&&n({success:!0,latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,poiName:e.address&&(e.address.poiName||e.address.street),type:3})},function(e){n&&n({success:!1,error:"unsupport"})},{geocode:!0,enableHighAccuracy:!0,timeout:3e3})},getDeviceId:function(n){plus.device&&plus.device.imei?n&&n({success:!0,id:plus.device.imei}):n({success:!1})},callPhone:function(n){plus.device.dial(n)},exit:function(){plus.runtime.quit()},share:function(){if(n){var e=!1;if(i?$.isString(i)&&(e=i):e="没有可用的分享服务",e)return void this.alert(e,n.onFail||$.noop);var t=[];for(var c in i){var u=i[c];u.authenticated&&(base.sendError(JSON.stringify(u)),n.limitWeixin&&u.id.indexOf("weixin")==-1||t.push({key:u.id,name:u.description}))}t.length&&o("分享到",t,function(e){i[e].send({title:n.title,content:n.desc||n.description,href:n.link,thumbs:[n.imgUrl]},n.onSuccess||$.noop,n.onFail||$.noop)})}},setShare:function(e){n=e}}});
/*![partner/kuaiqian.js]*/define("partner/kuaiqian",["partner/utils"],function(e){var n,i=function(n){var i=function(){window.kuaiqian?n&&n({success:!0}):setTimeout(i,50)};i(),$("body").append($.formatString('<div class="kuaiqian-share">\n<input id="shareTitle" type="hidden" value="#{title}" />\n<input id="shareData" type="hidden" value="" />\n<input id="shareNeedRealName" type="hidden" value="" />\n<input id="shareContent" type="hidden" value="#{desc}" />\n<input id="shareUrl" type="hidden" value="#{link}" />\n<input id="sharePreviewImageUrl" type="hidden" value="#{imgUrl}" />\n<input id="shareIconUrl" type="hidden" value="#{imgUrl}" />\n</div>',e.DEFAULT_SHARE))},a=base.onceExecMulitCallFn(function(){var e=this;kuaiqian.getAccessToken({success:function(n){e.done(n.accessToken)}})}),t=function(){return{detail_title_overlay:{right:"",rightTap:""},mine_title_overlay:{contentHtml:"我的"},hideHeader:!0,hideHeaderExclude:{title:"社区便利",viewNames:["home","menu","order"]},hideWelfare:!0}},r=function(e){kuaiqian.showToast({message:e})},o=function(e){kuaiqian.getGeoPosition({isMust:"0",success:function(n){e&&e({success:!0,type:1,latitude:n.latitude,longitude:n.longitude})},error:function(n){var i=n.errorCode;e&&e({success:!1,error:3001==i?"unavailable":3002==i?"denied":3003==i?"timeout":"unsupport",errmsg:n.errorMsg,errno:i})}})},s=function(e){n=e},u=function(){var i=n||e.DEFAULT_SHARE,a={shareTitle:i.title,shareContent:i.desc||i.description,shareUrl:i.link,shareIconUrl:i.imgUrl,sharePreviewImageUrl:i.imgUrl,success:i.onSuccess||$.noop,error:i.onFail||$.noop};kuaiqian.kuaiqianShare(a)},c=function(e){kuaiqian.getDeviceId({success:function(n){e&&e({success:!0,id:n.deviceId})},error:function(){e&&e({success:!1})}})},d=function(e){kuaiqian.tel({phoneNum:e})},l=function(){kuaiqian.goback()},h=function(){return{name:"快钱支付",key:"kuaiqian",typeid:10,pay:function(e,n,i){a(function(a){base.ajaxPost("/submit/kuaiqianinfo",{orderId:e.id||e.order_id,orderNo:e.order_no,accessToken:a},function(e){if(0==e.errno&&e.data&&0==e.data.code){var a=e.data.data;a.payOrderId=a.billOrderNo,a.merchantId=a.merchantCode,a.merchantOrderId=a.merchantOrderNo,a.success=function(e){n&&n()},a.error=function(e){i&&i(99==e.errorCode&&"支付被取消")},kuaiqian.pay(a)}else i&&i(e.data&&e.data.msg||e.errmsg)})})}}},f=function(e){return 10==e.typeid},p=function(e){kuaiqian.setPageTitle({title:e})},g=function(e,n,i){var a="__bee_kuaiqian_header_icon";if(window[a]=i,!n)switch(e){case"search":n="搜索";break;case"close":n="关闭";break;case"scan":n="扫码";break;case"share":n="分享";break;case"more":n="更多";break;case"delete":n="删除";break;case"reload":n="刷新"}kuaiqian.navigationBarMenu({menuList:[{name:n||e,functionName:a}]})},m=function(){return!0},k=function(e){e({success:!0})},v=function(e){a(function(n){base.ajaxPost("/submit/snsLoginAfter",{token:n,type:"KQ"},function(n){0==n.errno?e&&e({success:!0,phone:n.data.phone}):e&&e({success:!1,errno:n.errno,errmsg:n.errmsg})})})};return{name:"快钱",init:i,getLogicConf:t,tip:r,getDeviceId:c,callPhone:d,exit:l,getLocation:o,setShare:s,share:u,getPays:h,paysFilter:f,isLogin:m,login:k,autoLogin:v,setHeaderTitle:p,setHeaderRightIcon:g}});
/*![lib/Storage.js]*/define("lib/Storage",["lib/base","lib/EventObj"],function(t,e){var r="bee_",o=function(){var e=window.name.match(/^NS_(.+)/);if(e)try{this.storage=t.jsonDecode(e[1])}catch(t){this.storage={}}else this.storage={}};o.prototype={getItem:function(t){return this.storage[t]||null},setItem:function(e,r){this.storage[e]=r,window.name="NS_"+t.jsonEncode(this.storage)},removeItem:function(e){delete this.storage[e],window.name="NS_"+t.jsonEncode(this.storage)}};var n=$.inherits(e,{constructor:function(t){e.call(this),this.customKey=t,this.localStorage=window.localStorage||new o,this._hadSendError=!1},set:function(e,r,o){var n,s=this._getKey(e),i=$.isString(r)||$.isNumber(r)?r:t.jsonEncode(r);try{n=this.localStorage.setItem(s,i)}catch(e){t.sendError("Storage set error:"+String(e),"Storage.js")}return n},get:function(e){var r,o=this._getKey(e);try{r=this.localStorage.getItem(o)}catch(e){t.sendError("Storage get error"+String(e),"Storage.js")}return!r||0!==r.indexOf("{")&&0!=r.indexOf("[")?r:t.jsonDecode(r)},del:function(t){this.localStorage.removeItem(this._getKey(t))},_getKey:function(t){return r+this.customKey+"_"+t}});return n.NameStorage=o,n});
/*![common/Share.js]*/define("common/Share",function(){return{getWeixinDefaultShareObj:function(){return{title:"馋了吗？找爱鲜蜂！",description:"馋了？忙呢？召唤鲜蜂侠，鲜果咖啡，坚果卤味，各种新鲜，闪电送达！",imgUrl:"http://weixin.beequick.cn/static/bee/img/icon_100-6607ff98.png",link:"http://m.beequick.cn"}},getProductShareObj:function(e,i){return{title:"爱鲜蜂-各种新鲜闪电送达",description:"#爱鲜蜂# "+e.name,imgUrl:e.app_mimg,link:"http://m.beequick.cn/show/productDetail?id="+e.id+"&shopId="+i}},getOrderShareObj:function(e){var i=e.order_goods,t=i&&i[0]&&i[0][0]&&i[0][0].img?i[0][0].img:"http://weixin.beequick.cn/static/bee/img/icon_100-6607ff98.png";return{title:"爱鲜蜂-各种新鲜闪电送达",description:"我在爱鲜蜂补充能量ing……这里各种新鲜全都有，你懂的，千万别来找我！",imgUrl:t,link:"http://m.beequick.cn/show/share?key="+e.share_key}},getActiveShareObj:function(e){}}});
/*![common/weixinUtils.js]*/define("common/weixinUtils",["lib/base","common/Share"],function(n,e){var i={shareMask:'<div id="mod-sharemask" class="mod-sharemask"></div>'},o=!1,s=($.noop,function(n){o||$(i.shareMask).appendTo("body").on($.tapClick,function(){$(this).css("display","none")}),o=!0,$("#mod-sharemask").css("display","block").css("background-color",n?"rgba(0,0,0,.45)":"transparent")}),c=function(n,i){n=n||e.getWeixinDefaultShareObj(),t(function(e){if(e){var o={title:n.title,desc:n.description||n.desc,link:n.link,imgUrl:n.imgUrl,success:n.success||i||$.noop},s={title:n.description||n.desc,desc:n.title,link:n.link,imgUrl:n.imgUrl,success:n.success||i||$.noop},c=n.imgUrl.indexOf(".beequick.cn")==-1;"test"!=SYS_CONF.environ&&o.imgUrl.indexOf("@")<0&&c&&(o.imgUrl+="@100h_100w_0e_1l%7C90Q",s.imgUrl+="@100h_100w_0e_1l%7C90Q"),wx.onMenuShareTimeline(s),wx.onMenuShareAppMessage(o),wx.onMenuShareQQ(o),wx.onMenuShareWeibo(o)}})},r=function(n){return function(){t(function(e){e&&wx[n]&&wx[n]()})}},t=n.onceExecMulitCallFn(function(){var e=this;$.isWeixin&&window.wx&&window.SYS_CONF&&window.SYS_CONF.sns&&window.SYS_CONF.sns.weixinJsApiConf?(wx.config(window.SYS_CONF.sns.weixinJsApiConf),wx.ready(function(){e.done(!0),c()}),wx.error(function(i){window._bee_sendError("weixin init error:"+n.jsonEncode(i)),e.done(!1)})):e.done(!1)}),a=function(e){t(function(i){return i?void wx.scanQRCode({needResult:1,scanType:["qrCode"],success:function(i){if($.isString(i)){var o=n.jsonDecode(i.resultStr);e(!0,o.scan_code.scan_result)}else if(i.resultStr){var s=!1;try{s=n.jsonDecode(i.resultStr)}catch(n){}e(!0,s?s.scan_code.scan_result:i.resultStr)}},fail:function(n){e(!1,"扫描失败")},cancel:function(n){e(!1,"扫描被取消")}}):void e(!1,"认证失败")})},d=function(n,e){e=e||$.noop,n.timestamp=n.timestamp||n.timeStamp,n.success=n.fail=n.cancel=function(n){var i=n.err_msg||n.errMsg;i.indexOf("ok")>0?e(!0,"支付成功"):i.indexOf("cancel")>0?e(!1,"支付被取消"):e(!1,"支付失败")},t(function(i){return i?void wx.chooseWXPay(n):void e(!1,"认证失败")})},u=function(n){t(function(e){return e?void wx.getLocation({type:"wgs84",success:function(e){n(!0,e.res||e)},fail:function(e){n(!1,e.err_msg||e.errMsg)}}):void n(!1,"认证失败")})};return{init:t,showToolbar:r("showToolbar"),hideToolbar:r("hideToolbar"),showOptionMenu:r("showOptionMenu"),hideOptionMenu:r("hideOptionMenu"),closeWindow:r("closeWindow"),shareTip:s,setShare:c,scanQRCode:a,pay:d,getLocation:u}});
/*![common/nuomiUtils.js]*/define("common/nuomiUtils",["lib/base"],function(i){var t=i.onceExecMulitCallFn(function(){var i=this;$.isNuomi||this.done(!1),window.BNJS&&"object"==typeof window.BNJS&&BNJS._isAllReady?this.done(!0):document.addEventListener("BNJSReady",function(){i.done(!0)},!1)});return{setTitle:function(i,n){t(function(t){t&&BNJS.ui.title.setClickableTitle(i,n||$.noop)})},showLoading:function(i){t(function(t){t&&BNJS.ui.dialog.showLoading(i||"加载中")})},hideLoading:function(){t(function(i){i&&BNJS.ui.dialog.hideLoading()})},setRightBtn:function(i,n,e){t(function(t){if(t){BNJS.ui.title.removeBtnAll();var o={tag:1e3,callback:e||$.noop};if("search"==i||"scan"==i||"close"==i)o.icon=i;else if("reload"==i)o.text="刷新";else{if(!n)return;o.text=n}BNJS.ui.title.addActionButton(o)}})},setTitleTabs:function(i,n){t(function(t){t&&(BNJS.ui.title.removeBtnAll(),BNJS.ui.title.addTagList({id:1001,tagList:i.map(function(i){return i.name}),type:1,callback:function(t){0==t.errno&&i[t.data]&&n(i[t.data].key)}}))})},share:function(i){t(function(t){if(t){var n={title:i.title,content:i.desc||i.description,imgUrl:i.imgUrl,url:i.link,platforms:"weixin_session,weixin_timeline".split(",")};BNJS.ui.share(n)}})},init:t}});
/*![common/Promotion.js]*/define("common/Promotion",["lib/base","common/Dialog"],function(i,t){var r=function(i){if(!i)return!1;if(i.cids)for(var t in i.cids)if("代购香烟"==i.cids[t])return!0;return!!(.01==i.price&&i.name&&i.name.indexOf("【代购】")>-1)},n=function(i){this.shoppingCart=i,this.promotion=SYS_CONF.promotion,this.checkMethodList="exclusive,productExclusion,countLimit,brandExclusion,number,totalSku,pmLimit".split(","),this.defaultPropText=this.propText="￥0起送",this.cityid=0,this.shopCopy=null};return n.prototype={setShopCopy:function(i,t){1==arguments.length?this.shopCopy=i:2==arguments.length&&(this.shopCopy=this.shopCopy||{},this.shopCopy[i]=t)},setShopData:function(i){this.shopCopy=null,this.propText=this.defaultPropText,this.cityid=i.cityid},_getExclusive:function(){var t=i.safeGetProp(SYS_CONF,"promotion.exclusive");if(t){var r,n,o={};for(r in t)n=parseInt(t[r]),o[r]={checkNumber:n};return o}return!1},_getDefaultMinPrice:function(i){return 2==this.cityid?0:30},getPropText:function(i,t){if(this.shopCopy&&this.shopCopy[i])return this.shopCopy[i];if(1==i){var r="22,424,524,1644,1692,2472,2590,3134".split(",");return $.isInArray(r,this.cityid)?"￥0元起送，满￥99免运费，不满￥99收￥10运费":"¥0起送，满¥69免运费，不满¥69收¥10运费"}return i>=1e4?"免运费":this.shoppingCart.isSelfTakeVersion()||t?2==this.cityid?"￥0起送，22:00前满￥30免运费，22:00后满￥69免运费":22==this.cityid||424==this.cityid||524==this.cityid||1692==this.cityid||3134==this.cityid||1717==this.cityid?"¥0起送，22:00前满¥30免运费，22:00后满¥50免运费":1644==this.cityid?"￥0元起送，22点前满￥39免运费，22点后满￥49免运费":"¥0起送，满¥30减免运费":this.propText},checkShoppingCartError:function(i){return this._doCheck(this.checkMethodList,i)},getIsStart:function(i){return!(!this.promotion.timestart||!this.promotion.timestart[i])&&this.promotion.timestart[i].isStart},getStartConf:function(i){return this.promotion.timestart&&this.promotion.timestart[i]?this.promotion.timestart[i]:null},getMinPrice:function(i){return 0},_doCheck:function(i,t){for(var r,n=this.shoppingCart.getShoppingMap(!0,t.cart_group_id),o=0,e=i.length;o<e;o++){r=i[o];var s=this["_check_"+r](t,n,this.shoppingCart.shoppingList);if(s)return s}return!1},_check_exclusive:function(i,t){var n,o,e,s=!1,a=i.cid||i.category_id,h=!1;for(n in t){var c=t[n];if(s=!0,156==(c.category_id||c.cid)){h=c.name;break}}if(o=this._getExclusive())for(e in o){if(t[e])return i.id==e?i.name+"只能购买一个哦":t[e].name+"\n无法同其他商品同时购买哦";if(i.id==e&&s)return i.name+"只能单独下单哦"}var p=0,u=3;if(r(i)){for(var f in t)r(t[f])&&(p+=t[f].shoppingCount);if(this._hadNoticeCigarette||(this._hadNoticeCigarette=!0,this.shoppingCart._notice("亲，香烟价格以配送员提供为准，货到时与您当面结算。")),p>=u)return"抱歉，代购香烟限购"+u+"包"}if(156==a){if(h)return"秒杀商品一次仅能购买一个哦";if(s)return i.name+"只能单独下单哦"}else if(h)return h+"\n无法同其他商品同时购买哦"},_check_productExclusion:function(t,r){var n=i.safeGetProp(this.promotion,"exclusion.id");if($.isArray(n))for(var o=0,e=n.length;o<e;o++){for(var s,a=n[o].split(","),h=0,c=a.length;h<c&&(a[h]==t.id||!(s=r[a[h]]));h++);if(s&&$.isInArray(a,t.id))return s.name+" 和\n"+t.name+"\n不能同时购买哦~"}},_check_brandExclusion:function(t,r){var n=i.safeGetProp(this.promotion,"exclusion.brand");if($.isArray(n)){var o={};for(var e in r){var s=r[e];o[s.brand_id]=s.brand_name}for(var a=0,h=n.length;a<h;a++){var c=n[a].split(",");if(!$.isInArray(c,t.brand_id))return!1;for(var p=0,u=c.length;p<u;p++){var f=c[p];if(f!=t.brand_id&&!(t.cart_group_id>1e5&t.cart_group_id<15e4)&&o[f])return t.brand_name+" 和 "+o[f]+"\n需要在两个订单中购买哦~"}}}},_check_countLimit:function(i,t){var r,n,o=this.promotion.countLimit||{},e=i.id;if((r=parseInt(i.num_per_order||o[e]))&&(n=t[e]?t[e].shoppingCount:0,n>=r))return i.name+"\n最多只能购买"+r+"个哦~";var s=0,a=i.activity_id;if((r=parseInt(i.goods_num_per_order))&&a){for(var h in t)t[h].goods_num_per_order&&t[h].activity_id==a&&(s+=t[h].shoppingCount);if(s>=r)return 21480==a||21485==a||21503==a?"“德芙甜蜜+”巧克力只能领取一份哦~":"特价商品最多只能购买"+r+"个哦~"}},_check_number:function(i,t,r){var n;if(!(n=this._getExclusive())||!n[i.id]||n[i.id].checkNumber){if(parseInt(i.number)<1&&!parseInt(i.hot_degree))return i.name+" 补货中..\n过段时间再来看看吧~";var o=r[i.id]?r[i.id].shoppingCount:0;return i.number<=o?i.name+" 库存不足了\n先买这么多，过段时间再来看看吧~":void 0}},_check_totalSku:function(i,t,r){var n,o=99,e=0;if(!r[i.id]){for(n in r)e++;if(e==o)return"购物车最多可添加"+o+"种商品"}},_check_pmLimit:function(i,t,r){var n=i.pm_limit,o=t[i.id];if(o&&n&&$.isObject(n))for(var e in n){var s=n[e];if(s.goods_num_per_kind&&o.shoppingCount>=s.goods_num_per_kind)return i.name+"\n最多只能购买"+s.goods_num_per_kind+"个哦~"}}},n});
/*![common/ShoppingCart.js]*/define("common/ShoppingCart",["lib/EventObj","lib/Storage","common/Promotion"],function(i,t,s){var e={add:1,del:2,select:3,cancelSelect:4,selectAll:5,cancelSelectAll:6,delAll:7,other:0},o=function(i){if(i.id&&i.name){if(43==i.brand_id?i.brand_name="星巴克":155==i.brand_id&&(i.brand_name="吉野家"),i.promotion)if(parseInt(i.promotion)==i.promotion)i.num_per_order=i.promotion;else for(var t=decodeURIComponent(i.promotion),s=t.split("&"),e=0,o=s.length;e<o;e++){var n=s[e].split("="),r=n[0],a=n[1];if(2==n.length){if(0==a.indexOf("{"))try{a=base.jsonDecode(a)}catch(i){}i[r]=a}}return i}return!!i.id&&i.id},n=function(i){return parseFloat(Math.round(100*i)/100)},r=function(i,t){if($.isObject(i)&&$.isObject(t))for(var s in t)"shoppingCount"!=s&&"disabled"!=s&&"disabledText"!=s&&("dealer_id"!=s||t.dealer_id)&&("price"==s&&i.no_refresh&&!t.no_refresh||"isSelected"!=s&&(i[s]=t[s]));return i},a=function(i){return i.disabled===!0||1===i.disabled},p=function(){return $.isApple&&$.appVersion>="2.4"||$.isAndroid&&$.appVersion>95&&105!=$.appVersion},h=function(i,t,s){s=s||{},p()||!$.isApp?(t=$.isBoolean(t)?t?1:0:parseInt(t),0===t?(i.disabledText="",i.maskText="",delete i.disableDetail):(i.disabledText=s.disabledText||"商品缺货",s.maskText&&(i.maskText=s.maskText)||delete i.maskText,s.disableDetail&&(i.disableDetail=s.disableDetail)||delete i.disableDetail)):t===!0||1===parseInt(t)?(t=!0,i.disabledText=disabledText||"商品缺货"):(t=!1,i.disabledText=""),i.disabled=t},d=function(i){var t,s={0:100,1:300,2:200,3:250,4:150,true:300,false:100},e=$.isApple&&$.appVersion>=3.1||$.isAndroid&&$.appVersion>239||$.isMobile&&!$.isApp&&!$.isDaojia58,o=e?0:i.length-1,n="",r=!1;for(i.sort(function(i,t){return i.disabled==t.disabled?i.disabledText!=t.disabledText?i.disabledText>t.disabledText?1:-1:i.limit_goods&&t.limit_goods?i.limit_goods-t.limit_goods:i.maskText!=t.maskText?i.maskText>t.maskText?-1:1:0:s[i.disabled||0]-s[t.disabled||0]});t=i[o];)t.disabled||(t.showDisableText=0),t.disabledText!=n||t.limit_goods!=r?(n=t.disabledText,r=t.limit_goods,t.showDisableText=1):t.showDisableText=0,o=e?o+1:o-1;return i},c=(window.SYS_CONF.promotion.shoppingCart||{},$.inherits(i,{constructor:function(){i.call(this),this.storage=new t("shoppingcart"),this.shoppingList=this.storage.get("shoppingList")||{},$.each(this.shoppingList,function(i,t){"isSelected"in t||(t.isSelected=!0)}),this.promotion=new s(this),this.productMap={},this.cartInfoObj={},this._ignoreError=!1,this._orderRealtimeAmount={},this._calcCartInfo(),this._isTakeSelf=!1;var e=!$.isApp&&Bee.getMod("common/Dialog",!0);e?this.alert=function(i){e.alert(i.replace(/\n/g,"<br/>"))}:this.alert=$.noop,this._trackInfo=this.storage.get("track")||{},this._lastOpInfo={opSuccess:!0,opErrorMsg:"",noticeMsg:""}},addProduct:function(i,t){var s,e;if($.isString(i)||$.isNumber(i)){if(s=i,null==this.productMap&&!this.shoppingList[i])return void this._error("need setData before");if(!this.shoppingList[i]&&!this.productMap[s])return void this._error("id "+s+" 不存在")}$.isObject(i)&&(s=i.id,this.productMap[s]||(this.productMap[s]=i),i!=e&&(r(this.productMap[s],i),r(this.shoppingList[s],i))),e=this.productMap[s]||this.shoppingList[s],e=o(e);var n=this.promotion.checkShoppingCartError(e);return n?(this._error(n),!1):(2!=e.disabled&&h(e,!1),this._checkTakeSelf(e),t&&(e.track=t),e.track&&this._addTrack(e.id,e.track),this.shoppingList[s]||(this.shoppingList[s]=e,e.shoppingCount=0),this.shoppingList[s].shoppingCount++,this.shoppingList[s].isSelected=!0,this._fireChange("add",[s]),e)},deleteProduct:function(i,t){var s;if($.isString(i)||$.isNumber(i)){if(s=i,null==this.productMap&&!this.shoppingList[s])return this._error("need setData before"),!1}else s=i.id;return!(!this.shoppingList[s]&&!this.productMap[s])&&(!!this.shoppingList[s]&&(t?this.shoppingList[s].shoppingCount=0:this.shoppingList[s].shoppingCount--,2!=this.shoppingList[s].disabled&&h(this.shoppingList[s],!1),this.shoppingList[s].shoppingCount<1&&delete this.shoppingList[s],this._delTrack(s),this._fireChange("del",[s]),!0))},clearHideProduct:function(i){var t=[];if(i)for(var s in i)this.shoppingList[s]&&String(i[s].cart_group_id).indexOf("hide")>-1&&(t.push(this.shoppingList[s].id),delete this.shoppingList[s]);else for(var s in this.shoppingList)String(this.shoppingList[s].cart_group_id).indexOf("hide")>-1&&(t.push(this.shoppingList[s].id),delete this.shoppingList[s]);return this._fireChange("del",t),!0},addProductDataList:function(i){var t=this,s=function(i){$.each(i,function(i,s){t.addProductData(o(s))})};if($.isArray(i))s(i);else for(var e in i)if(!(parseInt(e)<=0)){var n=i[e];s(n)}},addProductData:function(i){i.price=parseFloat(i.price)||0,this.productMap[i.id]=o(i)},setProductList:function(i){var t=this,s={},e=[];return this.productMap={},this.promotion.propText="闪电送，免运费",$.each(i,function(i,s){parseInt(i)<=0||$.each(s,function(i,s){524==s.cityid&&(t.promotion.propText="闪电送，免运费"),s.price=parseFloat(s.price)||0,t.productMap[s.id]=s})}),$.each(this.shoppingList,function(i,o){var n=null;if(n=t.productMap[i]){if(!parseInt(n.number)&&!parseInt(n.hot_degree))return void e.push(n);s[i]=n,n.shoppingCount=o.shoppingCount}else e.push(o)}),this.shoppingList=s,this._fireChange("data"),e.length&&this.fire("unableAutoRemoved",{unableList:e}),this},getIsTakeSelf:function(){return this._isTakeSelf},setIsTakeSelf:function(i){this._isTakeSelf=i;var t=this;$.each(this.shoppingList,function(i,s){t._checkTakeSelf(s)})},setDisableProducts:function(i){$.isString(i)&&(i=i.split(","));for(var t=0,s=i.length;t<s;t++){var e=i[t];this.shoppingList[e]&&h(this.shoppingList[e],!0,{disabledText:"商品缺货",maskText:"补货中"})}this._fireChange("data",i)},setShopData:function(i,t,s){var e=[];if(i&&(t&&i.zchtid!=this.shopId&&(this.productMap={}),this.promotion.setShopData(i),this.shopId=i.zchtid,this.bigids=i.bigids,this.business=i.business),t){var n,a,p,d,c={};for(p=0,d=t.length;p<d;p++)if(a=o(t[p]),e.push(a.id),1!=a.is_gift&&(n=a.id,this.shoppingList[n])){a=r(this.shoppingList[n],a),a.number>0?h(a,!1):h(a,!0,{disabledText:"商品缺货",maskText:"补货中"}),c[n]=a,this.productMap[n]=a;var u=this.shoppingList[n],l=parseInt(u.shoppingCount),g=parseInt(a.number);g<1?(h(a,!0,{disabledText:"商品缺货",maskText:"补货中"}),a.shoppingCount=l):a.shoppingCount=l>g?g:l,i&&i.isInCart&&u.dealer_id&&(a.dealer_id=u.dealer_id),delete this.shoppingList[n]}for(n in this.shoppingList)a=this.shoppingList[n],h(a,!0,{disabledText:"商品缺货",maskText:"补货中"}),c[n]=a,156==(a.cid||a.category_id)&&this._notice("亲，有点小遗憾，您所在区域的此商品已抢光了！");this.shoppingList=c}if(s)this.promotion.setShopCopy(s);else if(i.business)for(var f in i.business){var _=i.business[f];_&&_.shopCopy&&this.promotion.setShopCopy(f,_.shopCopy)}this._fireChange("data",e)},setLimitGoods:function(i,t){var s=this;if($.isArray(i)){var e=[],o=[];$.each(i,function(i,t){var n=s.shoppingList[t.product_id];n&&(e.push(n.id),3==t.limit_type?h(n,!0,{disabledText:t.msg,maskText:"已下架",disableDetail:!0}):h(n,parseInt(t.limit_type),{disabledText:t.msg,maskText:1==t.limit_type?"补货中":""}),2==t.limit_type&&!$.isInArray(o,t.msg)&&o.push(t.msg),t.limit_goods&&(n.limit_goods=t.limit_goods))}),t&&o.length&&s._notice(o.join("\n")+"\n请重新核对商品信息"),s._fireChange("data",e)}},removeLimitStatus:function(i){var t=this.getShoppingMap(!0,i),s=[];$.each(t,function(i,t){t.isSelected&&2==t.disabled&&(s.push(i),h(t,!1))}),this._fireChange("data",s)},setSelected:function(i,t,s){i+="",t=!!t;var e={},o=[];$.each(i.split(","),function(i,t){e[t]=!0}),$.each(this.shoppingList,function(i,s){var n=s.id,r=s.cart_group_id||0;(e[n]||e["group"+r])&&(s.isSelected=t,o.push(n))}),this._fireChange("select",o)},again:function(i){var t=this,s=[],e=[];$.each(i,function(i,t){$.each(t,function(i,t){1!=t.is_gift&&(s.push(t.id),e.push(t))})});var n=this.shopId,r=this.bigids;base.ajaxGet("/data/getProductInfo",{pids:s.join(","),shopId:n,bigids:r,__sync:!0},function(i){var s,n;return 0!=i.errno?(s={},void t._error(i.errmsg)):(s=i.data,void $.each(e,function(i,e){(n=o(s[e.id]))?(n.shoppingCount=Math.min(e.goods_nums,n.number)||1,n.number<1&&h(n,1,{disabledText:"商品缺货",maskText:"补货中"})):(e.shoppingCount=parseInt(e.goods_nums)||1,e.price=parseFloat(e.goods_price||e.real_price),e.number=99,n=e,h(e,1,{disabledText:"商品缺货",maskText:"已下架",disableDetail:!0})),n.isSelected=!0,t.shoppingList[n.id]&&t.shoppingList[n.id].shoppingCount&&(n.shoppingCount=Math.min(n.number,n.shoppingCount+t.shoppingList[n.id].shoppingCount)),t.shoppingList[n.id]=n}))}),this._fireChange("data",s)},realtime:function(i,t,s,o){var n=[];this._ignoreError=!0;for(var r in s)this._realtimeUpdate(r,s[r].data,i==e.other);switch(parseInt(i)){case e.delAll:this.deleteProduct(t,e.delAll==i),n.push(t)}this.setIsTakeSelf(o),this._fireChange("data",n)},_realtimeUpdate:function(i,t,s){this._orderRealtimeAmount[i]=t.payable_amount,t.goods&&this.updateProduct(t.goods,!0),t.limit_goods&&this.setLimitGoods(t.limit_goods,s),t.dealer&&t.dealer.shopCopy&&this.promotion.setShopCopy(i,t.dealer.shopCopy)},updateProduct:function(i,t){if($.isArray(i))for(var s=0,e=i.length;s<e;s++){var o=i[s];$.isObject(o)?this._updateProduct(o.id,o,t):$.isArray(o)&&this.updateProduct(o,t)}else if($.isObject(i))if(i.id)this._updateProduct(i.id,i,t),this._fireChange("data",[i.id]);else for(var n in i){var o=i[n];$.isObject(o)&&this._updateProduct(n,o,t)}},getTrackInfo:function(i){i=i||0;var t,s,e,o={},n=this.getShoppingMap(!0,i);for(t in this._trackInfo)n[t]&&(s=this._trackInfo[t],s.length&&(e={},$.each(s,function(i,t){e[t]?e[t]++:e[t]=1}),o[t]=e));return o},_addTrack:function(i,t){this._trackInfo[i]||(this._trackInfo[i]=[]),this._trackInfo[i].push(t)},_delTrack:function(i){$.isArray(this._trackInfo[i])&&this._trackInfo[i].length&&(this._trackInfo[i].pop(),0==this._trackInfo[i].length&&delete this._trackInfo[i])},_updateProduct:function(i,t,s){if(!i||!t||!$.isObject(t))return!1;if(parseInt(i)==i&&this.shoppingList[i]){var e=o(t);if(e.is_gift)return!1;var n=$.extend(this.shoppingList[i],e);return"buy_num"in e?n.shoppingCount=parseInt(e.buy_num):n.shoppingCount=Math.min(n.shoppingCount,n.number),s&&(h(n,!1),n.isSelected=!0),"buy_state"in e&&(n.isSelected=1==e.buy_state),!0}return!1},_checkTakeSelf:function(i,t){(i.limit_take_self||t)&&(this._isTakeSelf?h(i,0):h(i,1,{disabledText:"仅限自提，请点击[修改]切换配送方式"}))},removeDisabledProduct:function(){var i=this,t=[];$.each(this.shoppingList,function(s,e){a(e)&&(delete e.disabled,delete i.shoppingList[s],t.push(s),i.productMap&&i.productMap[s]&&i.productMap[s].disabled&&delete i.productMap[s].disabled)}),this._fireChange("data",t)},getShoppingList:function(i,t){t=t||0;var s,e,o=[];for(e in this.shoppingList)s=this.shoppingList[e],i&&a(s)||(s.cart_group_id||0)==t&&o.push(s);return o},getShoppingMap:function(i,t){t=t||0;var s,e,o={};for(e in this.shoppingList)s=this.shoppingList[e],i&&a(s)||((s.cart_group_id||0)==t||String(t).indexOf("hide")>-1&&String(s.cart_group_id).indexOf("hide")>-1)&&(o[e]=s);return o},getProductById:function(i){return this.shoppingList[i]||null},getProductObjById:function(i){return this.productMap[i]},getGroupCountBy:function(i){var t={};return $.each(this.shoppingList,function(s,e){if(!a(e)){var o=e[i];t[o]=t[o]||0,t[o]+=e.shoppingCount}}),t},getIdformat:function(i,t){t=t||0;var s=[];for(var e in this.shoppingList){var o=this.shoppingList[e],n=o.cart_group_id||0;n==t&&(i&&o&&a(o)||o.isSelected&&s.push(e+":"+this.shoppingList[e].shoppingCount))}return s.join(",")},getPidDealers:function(i,t){t=t||0;var s=[];for(var e in this.shoppingList){var o=this.shoppingList[e],n=o.cart_group_id||0;n==t&&(i&&o&&a(o)||o.isSelected&&s.push(e+":"+(this.shoppingList[e].dealer_id||"")))}return s.join(",")},getPriceformat:function(i,t){t=t||0;var s=[];for(var e in this.shoppingList){var o=this.shoppingList[e],n=o.cart_group_id||0;n==t&&(i&&o&&a(o)||o.isSelected&&s.push(e+":"+(o.price||"")))}return s.join(",")},getCount:function(){return this.cartInfoObj.count},getDisabledCount:function(){var i=0;for(var t in this.shoppingList)this.shoppingList[t]&&a(this.shoppingList[t])&&i++;return i},getTotalPrice:function(){return this.cartInfoObj.price},reset:function(i){var t=this;if(void 0===i)this.shoppingList={},this._trackInfo={};else{var s={};$.each(this.shoppingList,function(e,o){var n=o.cart_group_id||0,r=!("isSelected"in o)||o.isSelected;return i==n&&r?void delete t._trackInfo[o.id]:void(s[e]=o)}),this.shoppingList=s}return this._fireChange("reset"),this},filter:function(i,t){var s=!1;t||(s={});for(var e in this.shoppingList){var o=this.shoppingList[e];if(i(o)){if(t){s=o;break}s[e]=o}}return s},getCartInfo:function(){return this.cartInfoObj},_calcCartInfo:function(){var i={},t=[],s=this;this.cartInfoObj=this._calcCartGroupInfo(),$.each(this.shoppingList,function(t,s){!s.cart_group_id||0==s.cart_group_id||String(s.cart_group_id).indexOf("hide")>-1||(i[s.cart_group_id||0]=!0)});var s=this;$.each(i,function(i){var e="group"+i;t.push(e),s.cartInfoObj[e]=s._calcCartGroupInfo(i)}),this.cartInfoObj.groups=t,this.cartInfoObj.group1||(this.cartInfoObj.group1=this._calcCartGroupInfo(1));var e=this.cartInfoObj.count,o=this.cartInfoObj.price;$.each(this.cartInfoObj.groups,function(i,t){var n=s.cartInfoObj[t];e+=n.count,o+=n.price}),o=n(o),this.cartInfoObj.totalCount=e,this.cartInfoObj.totalPrice=o,this.cartInfoObj.totalPriceText="共￥"+o},_calcCartGroupInfo:function(i){i=i||0;var t=0,s=0,e=!1,o="",r="",a=this.shoppingList,p=!0;minPrice=this.promotion.getMinPrice(i),name=this.business&&this.business[i]?this.business[i].title:"闪送超市",zeroOk=!1,$.each(this.getShoppingMap(!0,i),function(i,e){if(t+=parseInt(e.shoppingCount)||0,e.isSelected){var o=[110156,109686,111415];$.inArray(e.id,o)>=0&&(zeroOk=!0),s+=(parseFloat(e.price)||0)*e.shoppingCount}else p=!1}),void 0!==this._orderRealtimeAmount[i]&&(s=this._orderRealtimeAmount[i],delete this._orderRealtimeAmount[i]),s=n(s),e=zeroOk||s>0&&s>=minPrice,o=e?"选好了":0==s?"满￥"+minPrice+"起送":"差￥"+n(minPrice-s)+"起送",r="￥"+minPrice+"起送";var a=this.getShoppingList(!1,i);($.isAndroid&&$.appVersion>143||$.isApple&&$.appVersion>=2.6||$.isMobile)&&d(a);var h=this,c={name:name,cart_group_id:i,isAllSelected:p,isOk:e,payType:2,price:s,count:t,minPrice:minPrice,priceText:"共￥"+s,btnText:o,propText:h.promotion.getPropText(i,$.isMobile),cartText:r,emptyText:"购物车是空的",trackInfo:base.jsonEncode(h.getTrackInfo(i)),shoppingList:a};return this._isTakeSelf&&i&&(c.disable=!0,c.disabledText="新鲜预定暂不支持自提服务"),c},_updateUi:function(i,t){var s=this.getCartInfo(),e=s.totalCount,o=s.isOk;$.each(s.groups,function(i,t){var e=s[t];e.isOk&&(o=!0)}),i[e?"removeClass":"addClass"]("shopping-empty"),i.find(".shopping-count").html(e).css("visibility",e?"visible":"hidden").addClass("erect"),setTimeout(function(){i.find(".shopping-count").removeClass("erect")},150),i.find(".shopping-total").html(e?s.totalPriceText:s.emptyText),i.find(".shopping-words").html(this.promotion.getPropText(0)),i.find(".shopping-submit-text").html(o?t:s.btnText),i.find(".shopping-submit").attr("disabled",!o)[o?"addClass":"removeClass"]("shopping-enable")},_fireChange:function(i,t){this._calcCartInfo(),this.fire("shoppingListChange",{reason:i,pidsArr:t}),this.storage.set("track",this._trackInfo),this.storage.set("shoppingList",this.shoppingList)},_notice:function(i){this.alert(i),$.isAndroid&&$.appVersion<128||(this._lastOpInfo.noticeMsg=i)},_error:function(i){this._lastOpInfo.opSuccess=!1,this._lastOpInfo.opErrorMsg=i,this.alert(i)},getLastError:function(){var i=this._lastOpInfo;return this._lastOpInfo={opSuccess:!0,opErrorMsg:"",noticeMsg:""},this._ignoreError&&(this._ignoreError=!1,i.opSuccess=!0,i.opErrorMsg=""),i},isSelfTakeVersion:p}));return new c});
/*![common/AddrMgr.js]*/define("common/AddrMgr",["lib/base","lib/EventObj","lib/Storage","partner/Partner"],function(r,t,d,i){var e=null,n=function(r){r.id&&(this.id=r.id),this._setProp(r)};return n.prototype={_setProp:function(r){for(var t in r)this[t]=r[t],"address"==t&&(this.addressSp=this.address.split(" "));this.config=r},getFullAddress:function(){return this.city_name+this.address},getAddressHead:function(){return this.addressSp[0]||""},getAddressTail:function(){return this.addressSp[1]||""},getGenderName:function(){return 1==this.gender?"先生":2==this.gender?"女士":""},isPoiVersion:function(){return 2==this.addressSp.length},update:function(r){this._setProp(r)},toObject:function(){return this.config}},AddrMgr=$.inherits(t,{constructor:function(){t.call(this),this.addrObjs={},this._likelyAddrIdMap={},this._inited=this.lastAddrId=!1,this.storage=new d("addrmgr"),this.defaultAddrId=!i.getLogicConf("disableAutoSelectLastAddr")&&this.storage.get("defid"),window.SYS_CONF&&window.SYS_CONF.addrList&&this._init(window.SYS_CONF.addrList)},init:function(t){if(this._inited)return void(t&&t());var d=this;r.ajaxPost("/submit/getAddrList",{},function(r){0==r.errno?(d._init(r.data,!0),t&&t(),d.fire("addrListChange")):d.fire("addrError",{errmsg:r.errmsg})})},_init:function(r){var t=this;$.each(r,function(r,d){t.addrObjs[d.id]=new n(d)}),this._inited=!0,this.fire("addrListChange")},isInited:function(){return this._inited},logout:function(){this._inited=!1,this.addrObjs={},this.fire("addrListChange")},addNewAddr:function(t,d){var i=this,e=new n(t);r.ajaxPost("/submit/updateAddr",e.toObject(),function(r){if(0==r.errno){var t=r.data.id;e.id=t,i.addrObjs[t]=e,i.fire("addrListChange"),d&&d(e)}else d&&d(!1,r.errmsg),i.fire("addrError",{errno:r.errorno,errmsg:"添加失败:"+r.errmsg})})},updateAddr:function(t,d){var i=this,e=i.addrObjs[t.id];if(!e)return void i.fire("addrError",{errmsg:"更新失败:id不存在"});var n=$.extend(e.toObject(),t);r.ajaxPost("/submit/updateAddr",n,function(r){0==r.errno?(e.update(t),i.fire("addrListChange"),d&&d(e)):(d&&d(!1,r.errmsg),i.fire("addrError",{errno:r.errno,errmsg:"更新失败:"+r.errmsg}))})},delAddr:function(t,d){var i=this,e=i.addrObjs[t];e||this.fire("addrError",{errmsg:"删除失败:id不存在"}),r.ajaxPost("/submit/deleteAddr",{id:t},function(r){0==r.errno?(delete i.addrObjs[t],i.fire("addrListChange"),d&&d(e)):(d&&d(!1,r.errmsg),i.fire("addrError",{errno:r.errno,errmsg:"删除失败:"+r.errmsg}))})},setDefaultAddr:function(r){r||(r=""),this.defaultAddrId=r,this.storage.set("defid",r)},getDefaultAddr:function(){return this.addrObjs[this.defaultAddrId]||!1},getAddrById:function(r){return this.addrObjs[r]||!1},getAddrList:function(){var r=[];for(var t in this.addrObjs)r.push(this.addrObjs[t]);return r=r.sort(function(r,t){return parseInt(t.id)-parseInt(r.id)})},getAddrCount:function(){var r=0;for(var t in this.addrObjs)r++;return r},getFavShops:function(t){r.ajaxPost("/submit/selShop",{},function(r){0==r.errno&&t(r.data)})}}),AddrMgr.getAreaSel=function(t){e?t(e):r.ajaxGet("/data/getAreaInfo",{},function(r){0==r.errno&&(e=r.data,t(e))})},AddrMgr});
/*![common/Dialog_nuomi.js]*/define("common/Dialog_nuomi",["common/nuomiUtils","common/Dialog_phone"],function(n,o){var i={show:function(n){o.show(n)},hide:function(){o.hide()},alert:function(o,i,t){n.init(function(n){n&&BNJS.ui.dialog.show({message:$.htmlToText(o),ok:t||"确定",onConfirm:i||$.noop})})},confirm:function(o,i,t){n.init(function(n){n&&BNJS.ui.dialog.show({message:$.htmlToText(o),ok:"确定",cancel:"取消",onConfirm:i||$.noop,onCancel:t||$.noop})})},confirmText:function(o,i,t,e){n.init(function(n){n&&BNJS.ui.dialog.show({message:$.htmlToText(o),ok:e&&e[0]||"确定",cancel:e&&e[1]||"取消",onConfirm:i||$.noop,onCancel:t||$.noop})})},tip:function(o){n.init(function(n){n&&BNJS.ui.toast.show(o)})},popSelect:function(n){BNJS.ui.actionSheet.show({titleList:n.items.map(function(n){return n.name}),callback:function(o){0==o.errno&&n.items[o.data]?n.onselect&&n.onselect(n.items[o.data].key):n.oncancel&&n.oncancel()}})}};return i});
/*![common/Dialog.js]*/define("common/Dialog",function(){var n=$.isNuomi?Bee.getMod("common/Dialog_nuomi"):$.isMobile?Bee.getMod("common/Dialog_phone"):Bee.getMod("common/Dialog_www"),o={show:function(o){return n.show(o)},hide:function(){return n.hide()},alert:function(o,e,i){return n.alert(o,e,i)},verify:function(o,e,i,t){return n.verify(o,e,i,t)},confirm:function(o,e,i){return n.confirm(o,e,i)},confirmText:function(o,e,i,t){return n.confirmText(o,e,i,t)},tip:function(o){return n.tip(o)},popSelect:function(o){return n.popSelect(o)}};return o});
/*![m/Shop.js]*/define("m/Shop",["lib/base","lib/EventObj","common/ShoppingCart"],function(t,i,a){var e=$.inherits(i,{constructor:function(){i.call(this),this.shopId=this.status=this.addr=this.dealer=this.tmr_detail=this.designated_dealerid=this.isDealer=this._isGps=this.addrName=this.act_info=null,this.actMap={}},setAddr:function(i,a){if(t.getGeoLogid(),this._isGps=!!a,i===!1)return this.status="error",this.statusText="定位失败，请手动选择地址",this.addrName="定位失败",void this.fire("addrNameChange");var e=this;return this._isGps?(this.addrName="",this.isDealer=!1,i.poiName?(e.addrName=i.poiName+"附近",e.fire("addrNameChange")):t.getAddressInfoByPoint(i.latitude,i.longitude,function(t){e.addrName=(t.street||"定位地址")+"附近",e.fire("addrNameChange")})):(this.addrName=i.zchtid?"店铺:"+i.name:i.address,this.isDealer=!!i.zchtid,this.deferFire("addrNameChange")),this.load(i),this},getAddr:function(){return this.addr},getUserAddr:function(){return"error"!=this.status&&"unsupport"!=this.status&&!this._isGps&&(this.addr||!1)},getActivityById:function(t){if($.isString(t))return this.actMap[t]||!1;if($.isArray(t))for(var i,a=0,e=t;a<e;a++)if(i=this.actMap[t[a]])return i;return!1},getActivityByGroup:function(t){for(var i in this.actMap){var a=this.actMap[i];if(a.ext_params&&a.ext_params.activitygroup==t)return a}},load:function(i){var i=i||this.addr;if(i){this._fireProgressing({status:"loading",text:"加载中"});var e,s=this,r=(i.longitude||i.lng)+","+(i.latitude||i.lat),d=[];return(e=$.getParam("pid",""))&&d.push(e),s.designated_dealerid=""==s.designated_dealerid?"":$.getParam("dealerid",""),$.each(a.shoppingList,function(t,i){d.push(i.id)}),t.ajaxGet("/data/home",{cart_pids:d.join(","),location:r,defPid:e,designated_dealerid:s.designated_dealerid},function(r){if(0==r.errno&&r.data&&r.data.dealer){if(s.addr=i,s.dealer=r.data.dealer,s.shopId=s.dealer.zchtid,s.bigids=s.dealer.bigids,s.cityid=s.dealer.cityid,s.tmr_detail=r.data.tmr_detail,s.act_info=r.data.act_info,s.location_hash=r.data.location_hash,t.addAjaxPublicParamsHandler("locationHash",function(t){return $.extend(t,{location_hash:s.location_hash})}),$.isArray(s.dealer.business)){var d={};$.each(s.dealer.business,function(t,i){d[i.id]=i}),s.dealer.business=d}$.each(r.data.act_info,function(t,i){$.each(i.act_rows,function(t,a){"business"==i.type?$.each(a.act_rows,function(t,i){i.activity&&(s.actMap[i.activity.id]=i.activity)}):a.activity&&(s.actMap[a.activity.id]=a.activity)})});var n=r.data.cart_ids||[];e&&n&&n.length&&n[0]&&n[0].id==e&&(s.defProduct=n[0],n.shift()),a.setShopData(r.data.dealer,r.data.cart_ids),s._fireProgressing({status:"done",text:"加载完成"})}else s.dealer=s.tmr_detail=s.act_info=null,s.location_hash=s.shopId=s.bigids=0,s._fireProgressing({status:13e3==r.errno?"unsupport":"error",text:r.errmsg})}),this}},_fireProgressing:function(t){this.status=t.status,this.statusText=t.text,this.fire("progressing",t)}});return e});
/*![m/bootstrap.js]*/Bee.boot(["lib/Storage","partner/Partner","common/Dialog","common/Share","common/AddrMgr","m/Shop"],function(e,t,o,r,a,i){var n,s,d,c,p,u,l,g,f=null,h=function(){var e,t,o,r,a,i={},n=window.location.href.split("#"),s=n[1]?"#"+n[1]:"",d=n[0].split("?"),c=d[0].split("/"),p=(d[1]||"").split("&");if(e=c[2],o=c[3])for("menu"==o?t="/menu":"order"==o?t="/show/order":"show"==o||"quick"==o?t="/"+o+"/"+c[4]:"daojia58"==o&&c[4]&&(t="/daojia58/"+c[4]),r=5;c[r];)i[c[r]]=c[r+1],r+=2;else t="/";for(r=0,a=p.length;r<a;r++){var u=p[r].split("=");u[0]&&(i[u[0]]=decodeURIComponent(u[1]))}return{domain:e,path:t,search:i,hash:s}},m=function(){var e=h();if("/show/orderlist"==e.path)return{type:"boot",viewName:"orderlist"};if("/show/order"==e.path||"/daojia58/order"==e.path){var o={orderId:e.search.orderId||e.search.id,orderNo:e.search.orderNo||e.search.no};return $.isDaojia58&&(o={djOrderId:e.search.orderId||e.search.id}),{type:"boot",viewName:"order",args:o}}var r;if((r=$.getParam("agroup"))||(r=$.getParam("aid")))return{type:"boot",viewName:"act",args:function(e){var o;return(o=$.getParam("agroup")?e.getActivityByGroup(r):e.getActivityById(r.split(",")))?{activityObj:o,isAutoload:!0}:void t.alert("当前活动已经结束<br/>更多精彩活动等您参与~",$.noop,"去看看")}};if(r=$.getParam("pid"))return{type:"boot",viewName:"detail",args:function(e){if(e.defProduct)return e.defProduct}};if(r=$.getParam("cid"))return{type:"nav",viewName:"menu",args:{categoryId:r}};if(r=$.getParam("bootview")){if("tmr"==r)return{type:"nav",viewName:"act",args:function(e){if(e.tmr_detail)return{activityObj:e.tmr_detail,isAutoload:!0}}};if("mine"==r||"cart"==r)return{type:"nav",viewName:r};if("search"==r)return{type:"boot",viewName:"search",args:function(e){return{}}};if("orderlist"==r||"addrlist"==r||"coupon"==r||"msg"==r||"idea"==r||"help"==r||"about"==r||"shop"==r||"shopadd"==r||"pointsShop"==r)return{type:"boot",viewName:r}}var a,i;if(window.localStorage&&(a=window.localStorage.getItem("PAY_REDIRECT"))){i=a.split(",");var n=parseInt(i[2]);if(n&&(new Date).getTime()-n<36e5)return{type:"boot",viewName:"order",args:{orderId:i[0],orderNo:i[1]}}}},v=function(){if($.getParam("downloadTip",!1)){var t=new e("downloadTip"),o=(new Date).getTime(),r=t.get("closeTime");(!r||o>parseInt(r)+864e5)&&($("body").addClass("download-tip-show").append('<div id="mod-downloadtip" class="mod-downloadtip"><a href="'+base.addProtectedParams("/show/appDownload")+'">下载爱鲜蜂APP</a>&nbsp;&nbsp;更多缤纷好礼邀您共享</div>'),$("#mod-downloadtip").on($.tapClick,function(e){t.set("closeTime",(new Date).getTime()),e.target&&"A"==e.target.tagName||($("body").removeClass("download-tip-show"),setTimeout(function(){$(window).trigger("resize")},800))}))}},w=function(){if(c&&p&&u&&l&&d){t.getLogicConf("bootstrapLoading")&&t.hideLoading();var e=Bee.getMod("m/main",!0);if(e&&($("#mod-bootstrap").css("display","none"),e.init(n,s),v()),g){if("nav"==g.type)e.initNavs(g.viewName,g.args);else if("boot"==g.type){var o=Bee.getMod("m/ViewMgr"),r=e.getCheckView(),a=new o("boot",(!0));a.on("destroy",function(){e.initNavs()}),r&&a.setCheckView(r),a.changeView("bootstrap",g)}}else e.initNavs()}},y=function(){t.getLocation(function(e){c||(c=!0,e.success?n.setAddr(e,!0):n.setAddr(!1,!1),w())});var e=s.getDefaultAddr();!e||c||t.getLogicConf("disableAutoSelectLastAddr")||(c=!0,n.setAddr(e),w())},b=function(){var e=$("#m-phone-img-css").val(),t=$("#m-phone-lazy-css").val();base.loadCss({src:t,onload:function(){u=!0,w(),base.loadCss({src:e})}})},C=function(){window._m_lazy_loaded=function(){p=!0,w()};var e=$("#m-phone-lazy-js");e.attr("src",e.data("src"))},N=function(){var e=m();if(e){var t=e.args||{};$.isFunction(t)?n.on("progressing",function(o){l||"loading"==o.status||("done"==o.status&&(t=t(n),t&&(e.args=t,g=e)),l=!0,w())}):(g=e,l=!0,w())}else setTimeout(function(){l=!0,w()},1e3)},P=function(){t.init(function(e){t.getLogicConf("bootstrapLoading")&&t.showLoading($.isDaojia58?"":"定位中");var r=[];return t.isPartner()&&(t.getLogicConf("hideHeader")&&r.push("partner-hide-header"),t.getLogicConf("hideNavs")&&r.push("partner-hide-navs"),t.getLogicConf("hideWelfare")&&r.push("partner-unsupport-welfare"),t.isSupport("setHeaderRightIcon")||r.push("partner-unsupport-righticon"),t.getLogicConf("payDirectlyWhenConfirm")&&r.push("partner-payDirectlyWhenConfirm")),t.isSupport("share")||r.push("partner-unsupport-share"),r.length&&$("html").addClass(r.join(" ")),e.success||$.isWeibo?(d=!0,void w()):void o.alert("由于"+(e.errmsg||"未知原因")+"<br/>爱鲜蜂的部分功能会受到影响",function(){d=!0,w()})})},A=function(){if($.isApple){var e=0;$(document).on("touchstart",function(t){t.touches&&t.touches[0]&&(e=t.touches[0].pageY)}),$(document).on("touchmove",function(t){var o=$(t.target).parents(".scroller");if(!o.length){if($(t.target).parents(".mod-activity").length)return;if(window.vConsole&&$(t.target).parents(".vc-panel").length)return;return t.preventDefault(),!1}if(t.touches&&t.touches[0]){var r=t.touches[0].pageY,a=o[0];0==a.scrollTop&&r>e?t.preventDefault():r<e&&a.scrollTop+a.clientHeight==a.scrollHeight&&t.preventDefault()}})}$(document).delegate("label",$.tapClick,function(e){var t=$(this).attr("for"),o=document.getElementById(t);o&&o.type&&(o.checked=!0)})},D=function(e){f=e,n=new i,s=new a;try{A()}catch(e){}N(),y(),b(),C(),P()};D()});
